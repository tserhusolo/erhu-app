<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¾…å¸¸ç§¦è€å¸«âœç¯€å¥è¨“ç·´å¤§å¸«</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; touch-action: manipulation; }
        body { background: #F0F7FF; font-family: "Microsoft JhengHei", sans-serif; display: flex; flex-direction: column; align-items: center; padding: 10px; margin: 0; min-height: 100vh; }
        
        /* é é¢åˆ‡æ›æŒ‰éˆ• */
        .nav-link { position: absolute; top: 15px; left: 15px; background: #4A90E2; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.8rem; text-decoration: none; font-weight: bold; box-shadow: 0 4px 10px rgba(74,144,226,0.3); }

        .vip-card { background: white; padding: 25px 15px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #4A90E2; text-align: center; width: 100%; max-width: 340px; margin-top: 50px; }
        .main-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: #333; }
        
        /* ç¯€å¥é¡¯ç¤ºå€ */
        #rhythm-display { background: #f9f9f9; border: 2px dashed #ccc; border-radius: 12px; height: 80px; margin: 15px 0; display: flex; align-items: center; justify-content: center; gap: 15px; font-size: 1.8rem; font-weight: bold; }
        .answer-block { padding: 5px 10px; background: #e3f2fd; border-radius: 8px; min-width: 40px; text-align: center; }

        /* ç¯€å¥æ‹¼åœ–æ–¹å¡Š */
        .option-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; max-width: 340px; margin-top: 15px; }
        .rhythm-btn { background: white; border: 2px solid #4A90E2; border-radius: 15px; padding: 15px; font-size: 1.5rem; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 0 #357ABD; }
        .rhythm-btn:active { transform: translateY(3px); box-shadow: none; }
        .rhythm-btn span { display: block; font-size: 0.7rem; color: #666; margin-top: 5px; }

        .leaderboard-box { background: white; border: 2px solid #FFD700; border-radius: 15px; padding: 15px; width: 100%; max-width: 340px; margin-top: 15px; }
        .footer-area { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; }
        .copyright-text { font-size: 0.65rem; color: #4A90E2; text-align: left; opacity: 0.8; flex: 1; }
        .footer-logo { width: 60px; height: auto; margin-left: 10px; }

        #btn-play-task { background: #4A90E2; color: white; border: none; padding: 15px 40px; border-radius: 30px; font-weight: bold; width: 220px; margin: 15px 0; cursor: pointer; box-shadow: 0 4px 0 #2c5d94; }
    </style>
</head>
<body>

    <a href="index.html" class="nav-link">ğŸ» å›éŸ³æ„Ÿæ•™å®¤</a>

    <div class="vip-card">
        <div class="main-title">ç¾…å¸¸ç§¦è€å¸«ï½œç¯€å¥è¨“ç·´å¤§å¸«</div>
        <div style="font-size:0.9rem;">æŒ‘æˆ°è€…ï¼š<b id="display-name" style="color:#4A90E2">è¼‰å…¥ä¸­...</b></div>
        
        <div id="rhythm-display">
            <div id="ans-1" class="answer-block">?</div>
            <div id="ans-2" class="answer-block">?</div>
        </div>

        <div style="display:flex; justify-content: space-around; font-size: 0.85rem; color: #4A90E2; margin-bottom: 5px;">
            <div>ğŸ¥ ç›®å‰é€£æ“Šï¼š<span id="combo-now">0</span></div>
            <div>ğŸ† ç¯€å¥ç´€éŒ„ï¼š<span id="combo-max">0</span></div>
        </div>
    </div>

    <button id="btn-play-task" onclick="playTask()">ğŸ§ æ’­æ”¾ç¯€å¥é¡Œç›®</button>

    <div class="option-container">
        <button class="rhythm-btn" onclick="checkAns('1 -')">1 - <span>ä¸€æ‹ (1.0)</span></button>
        <button class="rhythm-btn" onclick="checkAns('5 5')">5 5 <span>åŠæ‹ (0.5+0.5)</span></button>
        <button class="rhythm-btn" onclick="checkAns('1. 5')">1. 5 <span>é™„é» (0.75+0.25)</span></button>
        <button class="rhythm-btn" onclick="checkAns('0')">0 <span>ç©ºæ‹ (ä¼‘æ­¢)</span></button>
    </div>

   <div class="leaderboard-box">
        <div style="text-align:center; font-weight:bold; margin-bottom:10px; color:#333;">ğŸ† å‰´éŸ»åŠéŸ³æ„Ÿé«˜æ‰‹æ¦œ (TOP 30)</div>
        <div id="leaderboard-list">é€£ç·šä¸­...</div>
        
        <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; display: flex; flex-direction: column; align-items: flex-start;">
            <a href="https://www.facebook.com/erhutslo/" target="_blank" style="text-decoration: none; color: #1877F2; font-weight: bold; font-size: 0.8rem; margin-bottom: 5px;">ğŸ”— å‰å¾€ç²‰çµ²å°ˆé </a>
            
            <div style="display: flex; justify-content: space-between; align-items: flex-end; width: 100%;">
                <div style="font-size: 0.65rem; color: #4A90E2; opacity: 0.8; text-align: left;">
                    Â© 2025 å‰´éŸ»åŠç‰ˆæ¬Šæ‰€æœ‰<br>
                    ç³»çµ±å—æ•¸ä½è‘—ä½œæ¬Šä¿è­·
                </div>
                <img src="logo.jpg" alt="å‰´éŸ»åŠ" style="width: 60px; height: auto;">
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyCKiDsQMsk6WkZASHAt9lmj-vZ6UmwO1SQ",
          authDomain: "erhu-leaderboard.firebaseapp.com",
          databaseURL: "https://erhu-leaderboard-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "erhu-leaderboard",
          storageBucket: "erhu-leaderboard.firebasestorage.app",
          messagingSenderId: "10526902650",
          appId: "1:10526902650:web:8052eef341e5338d202ec3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        let u = localStorage.getItem('erhuUserName') || "";
        let comb = 0, mComb = 0, currentTask = [], userChoice = [];
        const options = ['1 -', '5 5', '1. 5', '0'];

        window.onload = () => {
            if(!u) { location.href = 'index.html'; } // å¼·åˆ¶å…ˆåœ¨é¦–é ç™»å…¥
            document.getElementById('display-name').innerText = u;
            loadRecord();
            updLb();
        };

        function loadRecord() {
            db.ref('rhythm_leaderboard/' + u).once('value', (s) => {
                if(s.exists()) { mComb = s.val(); document.getElementById('combo-max').innerText = mComb; }
            });
        }

        function playTask() {
            userChoice = [];
            document.getElementById('ans-1').innerText = "?";
            document.getElementById('ans-2').innerText = "?";
            
            // éš¨æ©Ÿç”¢ç”Ÿå…©æ‹çš„é¡Œç›®
            currentTask = [options[Math.floor(Math.random()*4)], options[Math.floor(Math.random()*4)]];
            
            // æ¨¡æ“¬æ’­æ”¾ç¯€å¥ (æ­¤è™•éœ€ç¾…è€å¸«æœªä¾†æä¾›æœ¨é­šéŸ³æ•ˆæª”ï¼Œæš«ä»¥ç³»çµ±éŸ³ä»£æ›¿)
            alert("é¡Œç›®æº–å‚™æ’­æ”¾ï¼šè«‹ä»”ç´°è½ç¯€å¥è„ˆå‹•...");
            console.log("é¡Œç›®å…§å®¹ï¼š", currentTask);
            // é€™è£¡æ˜¯æœªä¾†ä¸²æ¥éŸ³æ•ˆæ’­æ”¾é‚è¼¯çš„åœ°æ–¹
        }

        function checkAns(val) {
            if(currentTask.length === 0) return;
            userChoice.push(val);
            document.getElementById(`ans-${userChoice.length}`).innerText = val;

            if(userChoice.length === 2) {
                if(JSON.stringify(userChoice) === JSON.stringify(currentTask)) {
                    comb++;
                    alert("âœ¨ å¤ªæ£’äº†ï¼ç¯€å¥å®Œå…¨æ­£ç¢ºï¼");
                    if(comb > mComb) { mComb = comb; db.ref('rhythm_leaderboard/' + u).set(mComb); }
                } else {
                    comb = 0;
                    alert("âŒ ç¯€å¥æœ‰é»èª¤å·®å–”ï¼Œå†è©¦ä¸€æ¬¡ï¼");
                }
                document.getElementById('combo-now').innerText = comb;
                document.getElementById('combo-max').innerText = mComb;
                currentTask = [];
            }
        }

        function updLb() {
            db.ref('rhythm_leaderboard').orderByValue().limitToLast(30).on('value', (s) => {
                const l = document.getElementById('leaderboard-list');
                let items = [];
                s.forEach((c) => { items.unshift({ n: c.key, s: c.val() }); });
                l.innerHTML = items.map((x, i) => `<div style="display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px dashed #eee; font-size:0.85rem;"><span>${i+1}. ${x.n}</span><span>${x.s}</span></div>`).join('');
            });
        }
    </script>
</body>
</html>
